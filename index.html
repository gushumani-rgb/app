<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Work From Anywhere</title>
  <meta name="description" content="Explore tips, guides, and insights on how to work from anywhere in the world. Stay productive, travel freely, and optimize your remote lifestyle." />

  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: auto; padding: 20px; background: #fff; color: #111; }
    header { text-align: center; margin-bottom: 30px; }
    article { margin-bottom: 40px; border-bottom: 1px solid #ccc; padding-bottom: 20px; }
    h1 { margin-top: 0; }
    h2 { margin-bottom: 5px; }
    .snippet { color: #555; }
    .featured-image { max-width: 100%; height: auto; margin-bottom: 10px; border-radius: 5px; }
    .meta { font-size: 0.9em; color: #444; margin-bottom: 10px; font-weight: 500; }
    a { color: inherit; text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <header>
    <h1>Work From Anywhere</h1>
  </header>

  <main id="posts" aria-live="polite">
    Loading posts...
  </main>

  <!-- Pull Blogger posts dynamically -->
  <script>
    function displayPosts(data) {
      const container = document.getElementById("posts");
      const entries = data.feed.entry || [];

      if (!entries.length) {
        container.innerHTML = "No posts found.";
        return;
      }

      container.innerHTML = "";
      entries.forEach(entry => {
        const title = entry.title.$t;
        const link = entry.link.find(l => l.rel === "alternate").href;

        let snippet = entry.content ? entry.content.$t : entry.summary?.$t || "";
        snippet = snippet.replace(/<[^>]*>?/gm, "").substring(0, 200) + (snippet.length > 200 ? "..." : "");

        let featuredImage = entry.media$thumbnail ? entry.media$thumbnail.url.replace(/\/s72-c\//, "/s600/") : "";
        const author = entry.author?.[0]?.name?.$t || "Unknown";
        const published = entry.published ? new Date(entry.published.$t).toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' }) : "";

        const article = document.createElement("article");
        article.setAttribute("role", "article");
        article.innerHTML = `
          ${featuredImage ? `<img src="${featuredImage}" alt="${title}" class="featured-image">` : ""}
          <h2><a href="${link}" target="_blank" rel="noopener noreferrer">${title}</a></h2>
          <div class="meta" aria-label="author and published date">By ${author} | ${published}</div>
          <p class="snippet">${snippet}</p>
        `;
        container.appendChild(article);
      });
    }

    const script = document.createElement("script");
    script.src = "https://thabogushumani.blogspot.com/feeds/posts/default?alt=json-in-script&callback=displayPosts&max-results=100";
    document.body.appendChild(script);
  </script>

  <!-- Web Push Notifications -->
  <script>
    function urlBase64ToUint8Array(base64String) {
      const padding = '='.repeat((4 - base64String.length % 4) % 4);
      const base64 = (base64String + padding).replace(/\-/g, '+').replace(/_/g, '/');
      const rawData = atob(base64);
      return Uint8Array.from([...rawData].map(c => c.charCodeAt(0)));
    }

    if ('serviceWorker' in navigator && 'PushManager' in window) {
      navigator.serviceWorker.register('/sw.js').then(async (reg) => {
        const permission = await Notification.requestPermission();
        if (permission === 'granted') {
          const subscription = await reg.pushManager.subscribe({
            userVisibleOnly: true,
            applicationServerKey: urlBase64ToUint8Array('BNDg5h2Qv4TzP6fLsRZjYbH4lEo1r9MJq6wH-7zK5FlR0NxO7u0GvU1y2CjfXgYc8sLkS0tJcZJH6l5Qy1Vx1x0')
          });

          await fetch('https://thabo.gushumani.workers.dev/subscribe', {
            method: 'POST',
            body: JSON.stringify(subscription),
            headers: { 'Content-Type': 'application/json' }
          });
        }
      });
    }
  </script>

</body>
</html>
