<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Work From Anywhere</title>
  <meta name="description" content="Explore tips, guides, and insights on how to work from anywhere in the world. Stay productive, travel freely, and optimize your remote lifestyle." />

  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: auto; padding: 20px; background: #ffffff; color: #111; }
    header { text-align: center; margin-bottom: 30px; }
    article { margin-bottom: 40px; border-bottom: 1px solid #ccc; padding-bottom: 20px; }
    h1 { margin-top: 0; }
    h2 { margin-bottom: 5px; }
    .snippet { color: #555; }
    .featured-image { max-width: 100%; height: auto; margin-bottom: 10px; border-radius: 5px; }
    .meta { font-size: 0.9em; color: #444; margin-bottom: 10px; font-weight: 500; }
    a { color: inherit; text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <header>
    <h1>Work From Anywhere</h1>
  </header>

  <main id="posts" aria-live="polite">
    Loading posts...
  </main>

  <script>
    // Display Blogger posts
    function displayPosts(data) {
      const container = document.getElementById("posts");
      const entries = data.feed.entry || [];

      if (!entries.length) {
        container.innerHTML = "No posts found.";
        return;
      }

      container.innerHTML = "";
      entries.forEach(entry => {
        const title = entry.title.$t;
        const link = entry.link.find(l => l.rel === "alternate").href;

        let snippet = entry.content ? entry.content.$t : entry.summary?.$t || "";
        snippet = snippet.replace(/<[^>]*>?/gm, "").substring(0, 200) + (snippet.length > 200 ? "..." : "");

        let featuredImage = entry.media$thumbnail ? entry.media$thumbnail.url.replace(/\/s72-c\//, "/s600/") : "";
        const author = entry.author?.[0]?.name?.$t || "Unknown";
        const published = entry.published ? new Date(entry.published.$t).toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' }) : "";

        const article = document.createElement("article");
        article.setAttribute("role", "article");
        article.innerHTML = `
          ${featuredImage ? `<img src="${featuredImage}" alt="${title}" class="featured-image">` : ""}
          <h2><a href="${link}" target="_blank" rel="noopener noreferrer">${title}</a></h2>
          <div class="meta" aria-label="author and published date">By ${author} | ${published}</div>
          <p class="snippet">${snippet}</p>
        `;
        container.appendChild(article);
      });
    }

    // Load Blogger posts dynamically
    const script = document.createElement("script");
    script.src = "https://thabogushumani.blogspot.com/feeds/posts/default?alt=json-in-script&callback=displayPosts&max-results=100";
    document.body.appendChild(script);
  </script>

  <!-- Firebase Notifications -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-messaging-compat.js"></script>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBk9CnCJlTnSkvdC2PNB6UYiV0BnAkO088",
      authDomain: "work-from-anywhere-ac57b.firebaseapp.com",
      projectId: "work-from-anywhere-ac57b",
      storageBucket: "work-from-anywhere-ac57b.firebasestorage.app",
      messagingSenderId: "1058696678009",
      appId: "1:1058696678009:web:a408c66c367439a22b22a8",
      measurementId: "G-KJ1LHJWTZX"
    };

    firebase.initializeApp(firebaseConfig);
    const messaging = firebase.messaging();

    // Request notifications
    function requestNotificationPermission() {
      Notification.requestPermission().then(permission => {
        if (permission === 'granted') {
          messaging.getToken({
            vapidKey: 'BDJXLByXJrQ8SbjR1D9TdXkC2FgobKde9J4HcpWpKTWGtul01NFSSwFkMESgpuj_6mneMUioheGNFajKWdYcK6Q'
          }).then(token => {
            console.log('FCM Token:', token);
            fetch(`https://iid.googleapis.com/iid/v1/${token}/rel/topics/all`, {
              method: 'POST',
              headers: { 'Authorization': 'key=m8CiUozg6owbUTM0E2cdpYGU4xr_EpoSeewTjaqx5f0' }
            }).then(res => {
              if(res.ok) console.log('Subscribed to topic "all"');
              else console.error('Failed to subscribe', res.status);
            }).catch(console.error);
          }).catch(console.error);
        }
      });
    }

    if (Notification.permission === 'default') requestNotificationPermission();

    // Handle foreground notifications
    messaging.onMessage(payload => {
      if (Notification.permission === 'granted') {
        const { title, body, icon, click_action } = payload.notification;
        const notification = new Notification(title, { body, icon });
        notification.onclick = function(event) {
          event.preventDefault();
          window.open(click_action, '_blank');
          notification.close();
        };
      }
    });
  </script>

  <!-- Service Worker Registration -->
  <script>
    if (typeof navigator.serviceWorker !== 'undefined') {
      navigator.serviceWorker.register('sw.js')
    </script>

</body>
</html>
