<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anywhere Income – Work from Anywhere & Earn Online in 2025</title>
<meta name="description" content="Anywhere Income 2025: Discover remote jobs, online earning tips, and guides to make money from home effortlessly.">
<link rel="manifest" href="/manifest.json">
<link rel="alternate" type="application/json" href="/index.json">
<style>
  body {margin:0;font-family:Arial,sans-serif;background:#f7f8fb;color:#4a5568;}
  .wrap {max-width:800px;margin:36px auto;padding:20px;}
  h1 {text-align:center;color:#0b63b8;margin-bottom:24px;}
  .search {width:100%;padding:8px;border-radius:8px;border:1px solid #e6eefb;margin-bottom:12px;}
  .post {background:#fff;border-radius:12px;padding:16px;margin-bottom:14px;box-shadow:0 6px 18px rgba(11,63,120,0.06);}
  .post h2 {margin:0 0 6px;font-size:16px;}
  .post img {width:100%;height:auto;aspect-ratio:5/2;min-height:160px;border-radius:8px;margin-bottom:8px;display:block;object-fit:cover;}
  .post-text {font-size:14px;margin-bottom:8px;min-height:80px;}
  .read-more {display:inline-block;margin-top:6px;color:#0b63b8;font-size:14px;text-decoration:none;}
  .date {font-size:12px;color:#1f2937;margin-top:8px;}
  .post-skeleton {background:#eceff6;border-radius:12px;height:200px;margin-bottom:14px;animation:pulse 1.2s infinite;}
  @keyframes pulse {0% {opacity:1;}50% {opacity:0.4;}100% {opacity:1;}}
  #posts {min-height:500px;}
</style>
</head>
<body>
<header class="wrap" role="banner" aria-label="Site header">
  <h1 id="site-title">Anywhere Income</h1>
</header>

<main id="maincontent" role="main" tabindex="-1">
  <div class="wrap">
    <input id="jsonFilter" class="search" placeholder="Filter posts...">
    <div id="posts">
      <div class="post-skeleton"></div>
      <div class="post-skeleton"></div>
      <div class="post-skeleton"></div>
    </div>
  </div>
</main>

<footer class="wrap" role="contentinfo" aria-label="Site footer" style="text-align:center;padding:12px;color:#4a5568;">
  <small>&copy; <span id="year"></span> Anywhere Income</small>
</footer>

<script>
document.getElementById('year').textContent = new Date().getFullYear();

// Fix paths for images or posts
function fixPath(path,type='post'){
  if(!path) return ''; 
  if(path.startsWith('http')||path.startsWith('/')) return path; 
  return type==='image'?'Images/'+path:'Posts/'+path;
}

// Time ago helper
function timeAgo(dateStr){
  const d=new Date(dateStr), now=new Date(), diff=Math.floor((now-d)/1000);
  if(diff<60) return diff+' second'+(diff!==1?'s':'')+' ago';
  if(diff<3600) return Math.floor(diff/60)+' minute'+(Math.floor(diff/60)!==1?'s':'')+' ago';
  if(diff<86400) return Math.floor(diff/3600)+' hour'+(Math.floor(diff/3600)!==1?'s':'')+' ago';
  return Math.floor(diff/86400)+' day'+(Math.floor(diff/86400)!==1?'s':'')+' ago';
}

// Create link element
function makeLink(href,title){
  const a=document.createElement('a');
  a.href=href;
  a.target='_blank';
  a.rel='noopener noreferrer';
  a.textContent=title;
  return a;
}

// Handle image error fallback
function handleImageError(img){
  img.onerror=null;
  img.src='data:image/svg+xml;utf8,'+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="500" height="200"><rect width="100%" height="100%" fill="#eceff6"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#9aa3b2" font-size="14">no image</text></svg>');
  img.alt='no image';
}

// Extract YouTube ID from URL
function getYouTubeId(link){
  if(!link) return null;
  try {
    const cleanLink = link.split(/[?&]/)[0];
    let videoId = null;
    if(cleanLink.includes('youtu.be/')) videoId = cleanLink.split('youtu.be/')[1];
    else if(cleanLink.includes('youtube.com/watch')){
      const urlParams = new URLSearchParams(link.split('?')[1] || '');
      videoId = urlParams.get('v');
    }
    return videoId;
  } catch(e){
    return null;
  }
}

// Load posts from index.json
async function loadPosts(){
  try{
    const res=await fetch('index.json',{cache:'no-cache'});
    if(!res.ok) throw new Error('Failed to fetch index.json');
    const data=await res.json();
    return Array.isArray(data)?data:[];
  } catch(e){
    console.warn('Error loading posts:',e);
    return [];
  }
}

// Render posts
function renderPosts(posts){
  const container = document.getElementById('posts'); 
  container.innerHTML = posts.length ? '' : 'No posts yet.';

  // Sort posts by date descending
  posts.sort((a,b)=>new Date(b.date) - new Date(a.date));

  posts.forEach(post => {
    const div = document.createElement('div'); 
    div.className = 'post';

    const titleText = post.title?.trim() || 'Untitled';
    const link = post.link || fixPath(post.content_file || post.path, 'post') || '#';

    // Title
    const h2 = document.createElement('h2'); 
    h2.appendChild(makeLink(link, titleText)); 
    div.appendChild(h2);

    // Auto-detect YouTube thumbnail
    let youtubeThumbnail = null;
    if(post.youtubeId){
      youtubeThumbnail = `https://img.youtube.com/vi/${post.youtubeId}/hqdefault.jpg`;
    } else if(post.link){
      const id = getYouTubeId(post.link);
      youtubeThumbnail = id ? `https://img.youtube.com/vi/${id}/hqdefault.jpg` : null;
    }

    // Images: YouTube thumbnail > post.image > featuredImage
    const images = [
      youtubeThumbnail,
      post.image && fixPath(post.image, 'image'),
      post.featuredImage && fixPath(post.featuredImage, 'image')
    ].filter(Boolean);

    const uniqueImages = [...new Set(images)];

    uniqueImages.forEach((src, index) => {
      const img = document.createElement('img'); 
      img.src = src; 
      img.alt = titleText; 
      img.decoding = 'async';
      img.width = 500;
      img.height = 200;
      if(index===0){img.loading='eager'; img.setAttribute('fetchpriority','high');}
      else img.loading='lazy';
      img.onerror = () => handleImageError(img); 
      div.appendChild(img);
    });

    // Summary
    const p = document.createElement('p'); 
    p.className = 'post-text';
    const text = (post.summary || post.excerpt || '').trim(); 
    const maxLength = 200;
    p.textContent = text.length > maxLength ? text.slice(0, maxLength) + '… ' : text;

    const readMore = makeLink(link, `Read more about "${titleText}"`);
    readMore.className = 'read-more';
    p.appendChild(readMore); 
    div.appendChild(p);

    // Date
    const d = document.createElement('div'); 
    d.className = 'date'; 
    d.textContent = post.date ? timeAgo(post.date) : ''; 
    div.appendChild(d);

    container.appendChild(div);
  });
}

// Filter posts
document.getElementById('jsonFilter').addEventListener('input', e=>{
  const q = e.target.value.toLowerCase().trim();
  Array.from(document.querySelectorAll('.post')).forEach(node=>{
    const title = node.querySelector('h2')?.innerText.toLowerCase() || '';
    const excerpt = node.querySelector('p')?.innerText.toLowerCase() || '';
    node.style.display = !q || title.includes(q) || excerpt.includes(q) ? '' : 'none';
  });
});

// Initial load + auto-refresh every 30s
(async()=>{
  const posts = await loadPosts();
  renderPosts(posts);
  setInterval(async()=>{
    const p = await loadPosts();
    renderPosts(p);
  },30000);
})();

// Service worker
if (typeof navigator.serviceWorker !== 'undefined') {
  navigator.serviceWorker.register('/sw.js');
}
</script>
</body>
</html>
