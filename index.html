<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anywhere Income – Work from Anywhere & Earn Online in 2025</title>
<meta name="description" content="Anywhere Income 2025: Discover remote jobs, online earning tips, and guides to make money from home effortlessly.">
<link rel="manifest" href="/manifest.json">
<link rel="alternate" type="application/json" href="/index.json">
<style>
  body {margin:0;font-family:Arial,sans-serif;background:#f7f8fb;color:#4a5568;}
  .wrap {max-width:800px;margin:36px auto;padding:20px;}
  h1 {text-align:center;color:#0b63b8;margin-bottom:24px;}
  .search {width:100%;padding:8px;border-radius:8px;border:1px solid #e6eefb;margin-bottom:12px;}
  .post {background:#fff;border-radius:12px;padding:16px;margin-bottom:14px;box-shadow:0 6px 18px rgba(11,63,120,0.06);}
  .post h2 {margin:0 0 6px;font-size:16px;}
  .post img {width:100%;height:auto;aspect-ratio:5/2;min-height:160px;border-radius:8px;margin-bottom:8px;display:block;object-fit:cover;}
  .post-text {font-size:14px;margin-bottom:8px;min-height:80px;}
  .read-more {display:inline-block;margin-top:6px;color:#0b63b8;font-size:14px;text-decoration:none;}
  .date {font-size:12px;color:#1f2937;margin-top:8px;}
  .post-skeleton {background:#eceff6;border-radius:12px;height:200px;margin-bottom:14px;animation:pulse 1.2s infinite;}
  @keyframes pulse {0% {opacity:1;}50% {opacity:0.4;}100% {opacity:1;}}
  #posts {min-height:500px;}
</style>
</head>
<body>
<header class="wrap" role="banner" aria-label="Site header">
  <h1 id="site-title">Anywhere Income</h1>
</header>

<main id="maincontent" role="main" tabindex="-1">
  <div class="wrap">
    <input id="jsonFilter" class="search" placeholder="Filter posts...">
    <div id="posts">
      <div class="post-skeleton"></div>
      <div class="post-skeleton"></div>
      <div class="post-skeleton"></div>
    </div>
  </div>
</main>

<footer class="wrap" role="contentinfo" aria-label="Site footer" style="text-align:center;padding:12px;color:#4a5568;">
  <small>&copy; <span id="year"></span> Anywhere Income</small>
</footer>

<script>
document.getElementById('year').textContent = new Date().getFullYear();

// --- Helpers ---
function fixPath(path,type='post'){ if(!path) return ''; if(path.startsWith('http')||path.startsWith('/')) return path; return type==='image'?'Images/'+path:'Posts/'+path; }
function timeAgo(dateStr){ const d=new Date(dateStr), now=new Date(), diff=Math.floor((now-d)/1000); if(diff<60) return diff+' second'+(diff!==1?'s':'')+' ago'; if(diff<3600) return Math.floor(diff/60)+' minute'+(Math.floor(diff/60)!==1?'s':'')+' ago'; if(diff<86400) return Math.floor(diff/3600)+' hour'+(Math.floor(diff/3600)!==1?'s':'')+' ago'; return Math.floor(diff/86400)+' day'+(Math.floor(diff/86400)!==1?'s':'')+' ago'; }
function makeLink(href,title){ const a=document.createElement('a'); a.href=href; a.target='_blank'; a.rel='noopener noreferrer'; a.textContent=title; return a; }
function handleImageError(img){ img.onerror=null; img.src='data:image/svg+xml;utf8,'+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="500" height="200"><rect width="100%" height="100%" fill="#eceff6"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#9aa3b2" font-size="14">no image</text></svg>'); img.alt='no image'; }
function getYouTubeId(link){ if(!link) return null; try { let match = link.match(/youtube\.com\/embed\/([a-zA-Z0-9_-]+)/); if(match) return match[1]; match = link.match(/youtu\.be\/([a-zA-Z0-9_-]+)/); if(match) return match[1]; if(link.includes('youtube.com/watch')){ const urlParams = new URLSearchParams(link.split('?')[1] || ''); return urlParams.get('v'); } return null; } catch(e){ return null; } }
async function loadPosts(){ try{ const res=await fetch('index.json',{cache:'no-cache'}); if(!res.ok) throw new Error('Failed to fetch index.json'); const data=await res.json(); return Array.isArray(data)?data:[]; } catch(e){ console.warn('Error loading posts:',e); return []; } }
function renderPosts(posts){ const container=document.getElementById('posts'); container.innerHTML = posts.length ? '' : 'No posts yet.'; posts.sort((a,b)=>new Date(b.date)-new Date(a.date)); posts.forEach(post=>{ const div=document.createElement('div'); div.className='post'; const titleText=post.title?.trim()||'Untitled'; const link=post.link||fixPath(post.content_file||post.path,'post')||'#'; const h2=document.createElement('h2'); h2.appendChild(makeLink(link,titleText)); div.appendChild(h2); let youtubeThumbnail=null; const videoId=post.youtubeId||getYouTubeId(post.link); if(videoId) youtubeThumbnail=`https://img.youtube.com/vi/${videoId}/hqdefault.jpg`; const images=[youtubeThumbnail,post.image&&fixPath(post.image,'image'),post.featuredImage&&fixPath(post.featuredImage,'image')].filter(Boolean); const uniqueImages=[...new Set(images)]; uniqueImages.forEach((src,index)=>{ const img=document.createElement('img'); img.src=src; img.alt=titleText; img.decoding='async'; img.width=500; img.height=200; if(index===0){img.loading='eager'; img.setAttribute('fetchpriority','high');} else img.loading='lazy'; img.onerror=()=>handleImageError(img); div.appendChild(img); }); const p=document.createElement('p'); p.className='post-text'; const text=(post.summary||post.excerpt||'').trim(); const maxLength=200; p.textContent=text.length>maxLength?text.slice(0,maxLength)+'… ':text; const readMore=makeLink(link,`Read more about "${titleText}"`); readMore.className='read-more'; p.appendChild(readMore); div.appendChild(p); const d=document.createElement('div'); d.className='date'; d.textContent=post.date?timeAgo(post.date):''; div.appendChild(d); container.appendChild(div); }); }
document.getElementById('jsonFilter').addEventListener('input', e=>{ const q=e.target.value.toLowerCase().trim(); Array.from(document.querySelectorAll('.post')).forEach(node=>{ const title=node.querySelector('h2')?.innerText.toLowerCase()||''; const excerpt=node.querySelector('p')?.innerText.toLowerCase()||''; node.style.display=!q||title.includes(q)||excerpt.includes(q)?'none':''; }); });
(async()=>{ const posts=await loadPosts(); renderPosts(posts); setInterval(async()=>{ const p=await loadPosts(); renderPosts(p); },30000); })();

// --- Browser default install prompt ---
window.addEventListener('beforeinstallprompt', (e) => {
  // Prevent default but do not create button
  e.preventDefault();
  console.log('Install prompt ready — browser will show default notification automatically when eligible');
});

// --- PWA Push Subscription ---
if ((window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) && 'serviceWorker' in navigator && 'PushManager' in window) {
  window.addEventListener('load', async () => {
    try {
      const reg = await navigator.serviceWorker.register('/sw.js');
      console.log('Service Worker registered:', reg.scope);

      const permission = await Notification.requestPermission();
      if (permission !== 'granted') {
        console.log('Notifications blocked');
        return;
      }

      const vapidRes = await fetch('/vapidPublicKey');
      const { publicKey } = await vapidRes.json();

      const subscription = await reg.pushManager.getSubscription() ||
        await reg.pushManager.subscribe({
          userVisibleOnly: true,
          applicationServerKey: urlBase64ToUint8Array(publicKey)
        });

      await fetch('/api/save-subscription', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(subscription)
      });

      console.log('Push notifications enabled', subscription);
    } catch (err) {
      console.error('Push notification error:', err);
    }
  });
}

function urlBase64ToUint8Array(base64String) {
  const padding = '='.repeat((4 - (base64String.length % 4)) % 4);
  const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');
  const rawData = window.atob(base64);
  const outputArray = new Uint8Array(rawData.length);
  for (let i = 0; i < rawData.length; ++i) {
    outputArray[i] = rawData.charCodeAt(i);
  }
  return outputArray;
}
</script>
</body>
</html>
