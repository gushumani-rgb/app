<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anywhere Income – Work from Anywhere & Earn Online in 2025</title>
<meta name="description" content="Anywhere Income 2025: Discover remote jobs, online earning tips, and guides to make money from home effortlessly.">
<style>
  body {margin:0;font-family:Arial,sans-serif;background:#f7f8fb;color:#4a5568;}
  .wrap {max-width:800px;margin:36px auto;padding:20px;}
  h1 {text-align:center;color:#0b63b8;margin-bottom:24px;}
  .search {width:100%;padding:8px;border-radius:8px;border:1px solid #e6eefb;margin-bottom:12px;}
  .post {background:#fff;border-radius:12px;padding:16px;margin-bottom:14px;box-shadow:0 6px 18px rgba(11,63,120,0.06);}
  .post h2 {margin:0 0 6px;font-size:16px;}
  .post img {border-radius:8px;margin-bottom:8px;}
  .post-text {font-size:14px;margin-bottom:8px;}
  .read-more {display:inline-block;margin-top:6px;color:#0b63b8;font-size:14px;text-decoration:none;}
  .date {font-size:12px;color:#1f2937;margin-top:8px;}
</style>
</head>
<body>
<header class="wrap" role="banner" aria-label="Site header">
  <h1 id="site-title">Anywhere Income</h1>
</header>

<main id="maincontent" role="main" tabindex="-1">
  <div class="wrap">
    <input id="jsonFilter" class="search" placeholder="Filter posts...">
    <div id="posts">Loading posts...</div>
  </div>
</main>

<footer class="wrap" role="contentinfo" aria-label="Site footer" style="text-align:center;padding:12px;color:#4a5568;">
  <small>&copy; <span id="year"></span> Anywhere Income</small>
</footer>

<script>
document.getElementById('year').textContent = new Date().getFullYear();

function fixPath(path,type='post'){
  if(!path) return ''; 
  if(path.startsWith('http')||path.startsWith('/')) return path; 
  return type==='image'?'Posts/'+path:'Posts/'+path;
}

function timeAgo(dateStr){
  const d=new Date(dateStr), now=new Date(), diff=Math.floor((now-d)/1000);
  if(diff<60) return diff+' second'+(diff!==1?'s':'')+' ago';
  if(diff<3600) return Math.floor(diff/60)+' minute'+(Math.floor(diff/60)!==1?'s':'')+' ago';
  if(diff<86400) return Math.floor(diff/3600)+' hour'+(Math.floor(diff/3600)!==1?'s':'')+' ago';
  return Math.floor(diff/86400)+' day'+(Math.floor(diff/86400)!==1?'s':'')+' ago';
}

function makeLink(href,title){
  const a=document.createElement('a');
  a.href=href;
  a.target='_blank';
  a.rel='noopener noreferrer';
  a.textContent=title;
  return a;
}

function handleImageError(img){
  img.onerror=null;
  img.src='data:image/svg+xml;utf8,'+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="500" height="200"><rect width="100%" height="100%" fill="#eceff6"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#9aa3b2" font-size="14">no image</text></svg>');
  img.alt='no image';
}

function getYouTubeThumbnail(link){
  if(!link) return null;
  const m=link.match(/(?:youtu\.be\/|youtube\.com\/watch\?v=)([a-zA-Z0-9_-]{11})/);
  return m?'https://img.youtube.com/vi/'+m[1]+'/hqdefault.jpg':null;
}

async function loadPosts(){
  try{
    const res=await fetch('index.json',{cache:'no-cache'});
    if(!res.ok) throw new Error('Failed to fetch index.json');
    const data=await res.json();
    return Array.isArray(data)?data:[];
  } catch(e){
    console.warn('Error loading posts:',e);
    return [];
  }
}

function renderPosts(posts){
  const container = document.getElementById('posts'); 
  container.innerHTML = posts.length ? '' : 'No posts yet.';

  let firstImageSet = false; // flag for first LCP image

  posts.forEach(post => {
    const div = document.createElement('div'); 
    div.className = 'post';

    const titleText = post.title?.trim() || 'Untitled';
    const link = post.link || fixPath(post.content_file || post.path, 'post') || '#';

    // Title
    const h2 = document.createElement('h2'); 
    h2.appendChild(makeLink(link, titleText)); 
    div.appendChild(h2);

    // Images
    const images = [
      getYouTubeThumbnail(post.link),
      post.image && fixPath(post.image, 'image'),
      post.featuredImage && fixPath(post.featuredImage, 'image')
    ].filter(Boolean);
    [...new Set(images)].forEach(src => {
      const img = document.createElement('img'); 
      img.alt = titleText; 

      // Async decoding and priority
      img.decoding = 'async';
      if(!firstImageSet){
        img.loading = 'eager';
        img.setAttribute('fetchpriority','high');
        firstImageSet = true;
      } else {
        img.loading = 'lazy';
      }

      // Handle errors
      img.onerror = () => handleImageError(img);

      // Responsive styling
      img.style.width = '100%';
      img.style.height = 'auto';

      // Dynamically set width and height to fix CLS/PageSpeed
      const temp = new Image();
      temp.src = src;
      temp.onload = () => {
        img.width = temp.naturalWidth;
        img.height = temp.naturalHeight;
      };

      img.src = src;
      div.appendChild(img);
    });

    // Excerpt
    const p = document.createElement('p'); 
    p.className = 'post-text';
    const text = (post.summary || post.excerpt || '').trim(); 
    const maxLength = 200;
    p.textContent = text.length > maxLength ? text.slice(0, maxLength) + '… ' : text;

    // Read More link
    const readMore = makeLink(link, `Read more about "${titleText}"`);
    readMore.className = 'read-more';
    p.appendChild(readMore); 
    div.appendChild(p);

    // Date
    const d = document.createElement('div'); 
    d.className = 'date'; 
    d.textContent = post.date ? timeAgo(post.date) : ''; 
    div.appendChild(d);

    container.appendChild(div);
  });

  // Sort by date
  Array.from(container.children)
    .sort((a, b) => new Date(b.querySelector('.date').textContent) - new Date(a.querySelector('.date').textContent))
    .forEach(n => container.appendChild(n));
}

// Filter posts
document.getElementById('jsonFilter').addEventListener('input', e=>{
  const q = e.target.value.toLowerCase().trim();
  Array.from(document.querySelectorAll('.post')).forEach(node=>{
    const title = node.querySelector('h2')?.innerText.toLowerCase() || '';
    const excerpt = node.querySelector('p')?.innerText.toLowerCase() || '';
    node.style.display = !q || title.includes(q) || excerpt.includes(q) ? '' : 'none';
  });
});

// Initial load & auto-refresh every 30s
(async()=>{
  const posts = await loadPosts();
  renderPosts(posts);
  setInterval(async()=>{
    const p = await loadPosts();
    renderPosts(p);
  },30000);
})();
</script>
</body>
</html>
